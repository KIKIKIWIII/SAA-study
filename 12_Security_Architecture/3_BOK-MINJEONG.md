# Encryption
## π” Encryption in flight (TLS/SSL)
> **μ „μ†΅ μ¤‘ μ•”νΈν™”**
- λ°μ΄ν„°κ°€ μ „μ†΅λκΈ° μ „μ— μ•”νΈν™”κ°€ λκ³  λ°›μ€ ν›„μ— ν•΄λ…λλ” κ²ƒ
- TLSλ” SSLμ κ°€μ¥ μµκ·Ό λ²„μ „
- no MITM (man in the middle attack; μ¤‘κ°„μ κ³µκ²©)
- μ¤μ§ νƒ€κ² μ„λ²„λ§ ν¨ν‚¤μ§€λ¥Ό ν•΄λ…ν•  μ μμ (μ¤‘κ°„ μ„λ²„ λ¶κ°€)

## π” Encryption at-rest
> μ €μ¥ μ¤‘ μ•”νΈν™”
### Server-side encryption at rest (SSE)
> **μ„λ²„ μΈ΅ μ €μ¥ μ¤‘ μ•”νΈν™”**
- **μ„λ²„ μΈ΅μ—μ„ μ €μ¥ μ „μ— μ•”νΈν™”ν•κ³ , κΊΌλ‚Ό λ• λ³µνΈν™”**
- λ°μ΄ν„°κ°€ μ•”νΈν™”λλ” κ³Όμ •μ΄ μ„λ²„κ°€ λ°›μ€ ν›„μ— μΌμ–΄λ‚¨
- λ°μ΄ν„°μ ν•΄λ…μ€ clientμ—κ² λλλ ¤ λ³΄λ‚΄κΈ° μ „μ— μ§„ν–‰
- μ•”νΈν™” λ μƒνƒλ΅ μ €μ¥ (μ£Όλ΅ data key μ΄μ©)
- **server-side μ•”νΈν™”λ” λ¨λ“  μ•”νΈν™”μ™€ ν•΄λ…μ΄ μ„λ²„μ—μ„ μΌμ–΄λ‚¨**

### Client-side encryption (CSE)
> **ν΄λΌμ΄μ–ΈνΈ μΈ΅ μ•”νΈν™”**
- **ν΄λΌμ΄μ–ΈνΈκ°€ λ°μ΄ν„°λ¥Ό μ§μ ‘ μ•”νΈν™”ν• λ’¤, μ•”νΈν™”λ λ°μ΄ν„°λ¥Ό μ„λ²„μ— μ €μ¥**
- λ°μ΄ν„°κ°€ ν΄λΌμ΄μ–ΈνΈ μΈ΅μ—μ„ μ•”νΈν™”μ™€ ν•΄λ…
- μ„λ²„λ” μ΄ λ°μ΄ν„°λ¥Ό ν•΄λ…ν•  μ μ—†μ–΄μ•Ό ν•¨   
<br>

## AWS WAF - Web Application Firewall
> **μ›Ή μ• ν”λ¦¬μΌ€μ΄μ… λ°©ν™”λ²½**
- **μ›Ή μ• ν”λ¦¬μΌ€μ΄μ…μ„ μ•…μμ μΈ κ³µκ²©(ex. SQL Injection, XSS)λ΅λ¶€ν„° λ³΄νΈν•κΈ° μ„ν• μ›Ή λ°©ν™”λ²½ μ„λΉ„μ¤**   
  *(μ›Ή νΈλν”½μ„ κ°μ‹ν•κ³  μ„ν—ν• μ”μ²­μ„ μ°¨λ‹¨ν•κ±°λ‚ ν—μ©ν•λ” μ—­ν• μ„ ν•¨)*   
- AWS WAFλ” κ³„μΈµ 7μ—μ„ μΌμ–΄λ‚λ” μΌλ°μ μΈ μ›Ή μ·¨μ•½μ  κ³µκ²©μΌλ΅λ¶€ν„° μ›Ή μ• ν”λ¦¬μΌ€μ΄μ…μ„ λ³΄νΈ
- **Layer 7 is HTTP** (vs Layer 4 is TCP/UDP) -> HTTP μ·¨μ•½μ  κ³µκ²©μ„ λ§‰μ•„μ£Όλ” κ²ƒ
- β­οΈ WAF λ°°ν¬
  - Application Load Balancer
  - API Gateway
  - CloudFront
  - AppSync GraphQL API
  - Cognito User Pool
  - *(NLBμ—λ” λ°°ν¬ λ¶κ°€)*

- **Web ACL** (Web Access Control List); **μ›Ή μ•΅μ„Έμ¤ μ μ–΄ λ©λ΅ κ·μΉ™**μ„ μ •ν•΄μ•Ό ν•¨ (WAF μ„¤μ •μ μ»¨ν…μ΄λ„ μ—­ν• )   
  - **IP Set**: up to 10,000 IP addresses - use multiple Rules for more IPs
  - HTTP Headers, HTTP bodyμ— κΈ°λ°ν•΄ ν•„ν„°λ§ κ°€λ¥
  - **String Match**: URL λ¬Έμμ—΄μ„ μ΅°κ±΄μΌλ΅ λ‘μ–΄ **SQL μ£Όμ…**, **Cross-Site Scripting(XSS)** λ“±μ μΌλ°μ μΈ κ³µκ²©λ„ μ°¨λ‹¨ν•  μ μμ
  - **GeoMatch**: μ©λ‰μ— μ μ•½μ„ κ±Έμ–΄ μ”μ²­μ΄ μµλ€ 2MBλ¥Ό λ„μ§€ μ•κ² ν•κ±°λ‚, μ§€μ—­ μΌμΉ(**Geo-match**) μ΅°κ±΄μ„ λ‘μ–΄ νΉμ • κµ­κ°€λ¥Ό ν—μ©/μ°¨λ‹¨ ν•  μ μμ
  - **Rate-based rules**(μ†λ„ κΈ°λ° κ·μΉ™)μ„ μ„¤μ •ν•λ©΄ IPλ‹Ή μ”μ²­ μλ¥Ό μΈ΅μ •ν•μ—¬ **DDoS κ³µκ²©μ„ λ§‰μ„ μ μμ**

- Web ACLμ€ λ¦¬μ „μ—λ§ μ μ©λλ©° CloudFrontλ” κΈ€λ΅λ²λ΅ μ •μλ¨
- **Rule Group**
  - μ—¬λ¬ κ°μ λ£°μ„ κ·Έλ£ΉμΌλ΅ λ¬¶μ–΄ μ¬μ‚¬μ© κ°€λ¥
- <u>WAFλ” νΈλν”½μ΄ λ„μ°©ν•κΈ° μ „μ— μ‘λ™ν•΄μ„, κ³µκ²© νΈλν”½μ€ λ°±μ—”λ“ μ„λ²„μ— λ„λ‹¬ν•κΈ°λ„ μ „μ— μ°¨λ‹¨λ¨</u>   
![alt text](images/image3.png)

### WAF - Fixed IP while using WAF with a Load Balancer
> μλ¥Ό λ“¤μ–΄, μ• ν”λ¦¬μΌ€μ΄μ…μ— κ³ μ • IPλ¥Ό μ‚¬μ©ν•λ©΄μ„ λ΅λ“ λ°Έλ°μ„μ™€ ν•¨κ» WAFλ¥Ό μ‚¬μ©ν•κ³  μ‹¶μ€ κ²½μ°    
> *(λ©ν‘ μƒν™©: κ³ μ • IP μ£Όμ†λ΅ μ ‘κ·Όν•λ©΄μ„ WAFλ¥Ό ν†µν•΄ μ›Ή κ³µκ²©λ„ λ§‰κ³  μ‹¶μ)*   
> - β… IPλ” ν•­μƒ κ³ μ •μ΄μ–΄μ•Ό ν•κ³ 
> - β… λ³΄μ•(WAF)λ„ μ μ©λμ–΄μ•Ό ν•¨
> - β… λ’¤μ—λ” λ΅λ“ λ°Έλ°μ„λ„ μ‚¬μ©ν•΄μ•Ό ν•¨ (νΈλν”½ λ¶„μ‚°)
- WAFλ” Network Load Balancerλ¥Ό μ§€μ›ν•μ§€ μ•μ
  - NLBλ” 4κ³„μΈµ, WAFλ” 7κ³„μΈµμ—μ„λ§ μ‘λ™ν•λ‹κΉ
- λ”°λΌμ„ WAFλ¥Ό μ κ³µν•λ ¤λ©΄ **Application Load Balancer**κ°€ μμ–΄μ•Ό ν•¨ -> *WAFλ¥Ό μ“°κ³  μ‹¶λ‹¤λ©΄ λ¬΄μ΅°κ±΄ ALBλ¥Ό μ¨μ•Ό ν•¨*
  - but, ALBλ” κ³ μ • IPκ°€ μ—†μ
- μ΄λ° λ¬Έμ λ” **AWS Global Accelerator**λ΅ <u>κ³ μ • IP</u>λ¥Ό ν• λ‹Ήλ°›μ€ λ‹¤μ ALBμ—μ„ WAFλ¥Ό ν™μ„±ν™”ν•λ©΄ ν•΄κ²°     
![alt text](images/WAF.png)   
> **"κ³ μ • IP + WAF + λ΅λ“ λ°Έλ°μ„" μ΅°ν•©μ΄ λ‚μ¤λ©΄ -> Global Accelerator + ALB + WAF**    
> *(Global Acceleratorλ” κ³ μ • IP μ κ³µ + μ„±λ¥ μµμ ν™” μ©λ„λ΅ μμ£Ό μ–ΈκΈ‰λ¨)*


## AWS Shield: protect from DDoS attack
> AWS Shieldλ” **λ””λ„μ¤ κ³µκ²©μΌλ΅λ¶€ν„° μ¤μ¤λ΅λ¥Ό λ³΄νΈν•κΈ° μ„ν• μ„λΉ„μ¤**
- **DDoS**: Distributed Denial of Services (λ¶„μ‚° μ„λΉ„μ¤ κ±°λ¶€ κ³µκ²©)
  - μΈν”„λΌμ— λ™μ‹μ— μ—„μ²­λ‚ μ–‘μ μ”μ²­μ΄ μ„Έκ³„ κ³³κ³³μ μ—¬λ¬ μ»΄ν“¨ν„°μ—μ„ μ μ…λλ” κ³µκ²©
  - λ©μ μ€ μΈν”„λΌμ— κ³Όλ¶€ν•λ¥Ό μΌμΌν‚¤λ” κ²ƒμΌλ΅ μ‹¤μ  μ‚¬μ©μμ—κ² μ„λΉ„μ¤λ¥Ό μ κ³µν•  μ μ—†κ² λ§λ“¦
- **AWS Shield Standard:**
  - λ¨λ“  AWS κ³ κ°μ—κ² λ¬΄λ£λ΅ ν™μ„±ν™”λμ–΄ μλ” μ„λΉ„μ¤
  - SYN/UDP Floods, λ°μ‚¬ κ³µκ²© λ° L3/L4 κ³µκ²©μΌλ΅λ¶€ν„° κ³ κ°μ„ λ³΄νΈν•΄ μ¤
- **AWS Shield Advanced:**
  - μ„ νƒμ μΌλ΅ μ κ³µλλ” λ””λ„μ¤ μ™„ν™” μ„λΉ„μ¤
  - μ΅°μ§λ‹Ή μ›” 3,000λ‹¬λ¬
  - μ–΄λ“λ°΄μ¤λ“μ—μ„λ” λ”μ± μ •κµν• λ””λ„μ¤ κ³µκ²©μ„ λ§‰μ•„μ£Όλ©° *Amazon EC2, ELB, Amazon CloudFront, AWS Global Accelerator, Route 53*μ„ λ³΄νΈ
  - AWS λ””λ„μ¤ λ€μ‘ ν€μ΄ ν•­μ‹ λ€κΈ°ν•κ³  μμ–΄ κ³µκ²©μ„ λ°›μ•μ„ λ• μ§€μ›λ°›μ„ μ μμ
  - λ””λ„μ¤ κ³µκ²©μΌλ΅ μΈν• μ”κΈ μƒμΉμ„ λ°©μ§€ν•  μ μμ
  - μλ™ μ• ν”λ¦¬μΌ€μ΄μ… κ³„μΈµ λ””λ„μ¤ μ™„ν™”λ„ μ κ³µν•μ—¬ μλ™μΌλ΅ WAF κ·μΉ™μ„ μƒμ„±, ν‰κ°€, λ°°ν¬ν•¨μΌλ΅μ¨ 7κ³„μΈµ κ³µκ²©μ„ μ™„ν™”ν•  μ μμ

## AWS Firewall Manager
> **AWS Organizationsμ— μλ” λ¨λ“  κ³„μ •μ λ°©ν™”λ²½ κ·μΉ™μ„ κ΄€λ¦¬ν•λ” μ„λΉ„μ¤ (μ¤‘μ•™μ§‘μ¤‘μ‹ κ΄€λ¦¬)**
- κΈ°μ—…μ΄λ‚ ν€μ—μ„ AWS κ³„μ •μ„ μ—¬λ¬ κ° μ‚¬μ©ν•  λ•, λ³΄μ• μ •μ±…μ„ μ¤‘μ•™μ—μ„ μΌκ΄„μ μΌλ΅ κ΄€λ¦¬ν•  μ μκ² ν•΄μ£Όλ” μ„λΉ„μ¤
- μ—¬λ¬ κ³„μ •μ κ·μΉ™μ„ λ™μ‹μ— κ΄€λ¦¬ν•  μ μμ
- **Security Policy**: λ³΄μ• κ·μΉ™μ μ§‘ν•©
  - WAF rules (ALB, API Gateway, CloudFront) μλ™ λ°°ν¬
  - AWS Shield Advanced (ALB, CLB, NLB, Elastic IP, CloudFront) κ΄€λ¦¬
  - EC2, ALB, VPCμ ENI λ¦¬μ†μ¤λ¥Ό μ„ν• λ³΄μ• κ·Έλ£Ήμ„ ν‘μ¤€ν™”ν•λ” λ³΄μ• μ •μ±…
  - AWS Network Firewall (VPC level) μ •μ±… κ΄€λ¦¬; κ° VPC μμ¤€μ λ„¤νΈμ›ν¬ λ°©ν™”λ²½ μ„¤μ • μΌκ΄„ μ μ©
  - Amazon Route 53 Resolver DNS Firewallμ΄ ν¬ν•¨λ¨
  - μ •μ±…μ€ λ¦¬μ „ μμ¤€μ—μ„ μƒμ„±λλ©° μ΅°μ§μ— λ“±λ΅λ λ¨λ“  κ³„μ •μ— μ μ©

- μλ¥Ό λ“¤μ–΄, μ΅°μ§μ—μ„ μ• ν”λ¦¬μΌ€μ΄μ… λ΅λ“ λ°Έλ°μ„μ— λ€ν• WAF κ·μΉ™μ„ μƒμ„±ν• λ‹¤μ μƒ ALBλ¥Ό μƒμ„±ν•λ” κ²½μ° **AWS Firewall Managerμ—μ„ μλ™μΌλ΅ μƒ ALBμ—λ„ κ°™μ€ κ·μΉ™μ„ μ μ©ν•΄ μ¤**

### WAF vs Firewall Manager vs Shield
- λ¨λ‘ ν¬κ΄„μ μΈ κ³„μ • λ³΄νΈλ¥Ό μ„ν• μ„λΉ„μ¤
- WAFμ—μ„λ” μ›Ή ACL κ·μΉ™μ„ μ •μν•λ”λ° **λ¦¬μ†μ¤λ³„ λ³΄νΈλ¥Ό κµ¬μ„±ν•λ” λ°μ—λ” WAFκ°€ μ μ **
- μ—¬λ¬ κ³„μ •μ—μ„ WAFλ¥Ό μ‚¬μ©ν•κ³ , WAF κµ¬μ„±μ„ κ°€μ†ν•κ³  μƒ λ¦¬μ†μ¤ λ³΄νΈλ¥Ό μλ™ν™”ν•λ ¤λ©΄ Firewall Managerλ΅ WAF κ·μΉ™μ„ κ΄€λ¦¬ν•λ©΄ λ¨
- Firewall Managerλ” λ¨λ“  κ³„μ •μ— Shield μ–΄λ“λ°΄μ¤λ“λ¥Ό λ°°ν¬ν•λ” λ°μ—λ„ ν™μ©