## 서버 밀도와 비용 최적화

- 가상화 혁명 이후 **서버 밀도 크게 향상**
- 과거: 기술적 측면(서버당 생산성 향상)에 초점
- 현재: 재무적 측면과 사업 가치 증대에 초점

### AWS 비용 최적화 주요 전략

1. 서버 밀도 관리 전략
2. 예약 인스턴스(RI) 활용
3. 스팟 인스턴스 활용

## 서버 밀도 최대화 방법

### 워크로드에 맞는 인스턴스 선택

- 성능 최적화와 비용 최적화 모두에 중요
- 인스턴스 타입별 특징은 AWS 공식문서 참조

> **워크로드에 맞는 인스턴스란?**  
> 워크로드에 맞는 인스턴스란 애플리케이션이 필요로 하는 리소스(CPU, 메모리, 스토리지, 네트워크 대역폭)에 최적화된 인스턴스를 의미함.
> 
> **예시**
> - 컴퓨팅 집약적 작업 → C 시리즈
> - 메모리 집약적 작업 → R 시리즈
> - 균형 잡힌 성능 → M 시리즈
> - 저비용 웹서버 → T 시리즈

### 서버리스 및 컨테이너 기술

- **AWS Lambda**: 서버 밀도 향상에 도움
- **ECS, EKS**: 컨테이너 기술로 마이크로서비스를 긴밀하게 결합 가능

## EC2 예약 인스턴스(Reserved Instance)

### 기본 개념

- 최소 12개월 사용 조건으로 구매
- 온디맨드 대비 대폭 할인된 가격

### 예약 인스턴스 유형

- **전환형 예약 인스턴스**
    - 중간에 인스턴스 교체 가능
    - 온디맨드 대비 최대 54% 할인

- **표준 예약 인스턴스**
    - 중간에 교체 불가
    - 온디맨드 대비 최대 75% 할인

- **스케줄드 인스턴스**    
    - 반복적인 일정에 따라 인스턴스 실행
    - 일정 단위로 구매 가능

### 비용 지불 옵션

- **전체 선결제**: 가장 저렴한 옵션
- **부분 선결제**: 중간 수준 할인
- **선결제 없음**: 시간 단위로 비용 청구

> **온디맨드와 선결제 없음 옵션의 차이는?**
> 
> - **온디맨드**: 약정 없이 사용한 만큼만 지불, 언제든지 시작/중지 가능
> - **선결제 없음 RI**: 1년 또는 3년 약정 필요, 월별 요금으로 지불하지만 온디맨드보다 저렴한 시간당 요금 적용, 약정 기간 동안 계속 비용 발생
> 
> 즉, 선결제 없음 RI는 선결제는 없지만 약정 기간 동안 인스턴스를 사용하지 않더라도 요금이 계속 청구되는 대신 온디맨드보다 시간당 요금이 저렴.

### Savings Plans

- EC2 지불 방식으로 최근 추가된 옵션
- 1-3년간 동일 수준 서비스 사용 계약 체결
- 예약 인스턴스와 유사하지만 더 높은 유연성 제공

#### 유형

- **Compute Savings Plans**
    - 온디맨드 대비 66% 저렴
    - EMR, ECS, EKS, Fargate 워크로드 처리 가능
    - AWS 리전 간 리소스 변경 가능

- **EC2 Instance Plans**    
    - 온디맨드 대비 72% 저렴
    - 단일 AWS 리전 내에서만 리소스 변경 가능

## EC2 스팟 인스턴스

### 개념
- 단기간 EC2 인스턴스를 빌려 쓰는 개념
- 매우 저렴한 비용
- 생애주기 관리의 변동성이 크고 조건에 따라 언제든 종료될 수 있음

### 주요 용어
- **Spot Price**: 스팟 인스턴스의 현재 가격
- **Spot Instance Interruption**: 수요 증가나 가격 변동으로 인한 인스턴스 중단
- **Spot Instance Pool**: 동일한 인스턴스 유형의 미사용 EC2 집합
- **Spot Fleet**: 다양한 스팟 인스턴스 유형을 조합하여 사용하는 방법
- **Request Type**: 일회성 또는 지속적 요청 타입 지정 가능

### 활용 방법
- EC2 대시보드에서 스팟 인스턴스 요청 설정 가능
- 특정 임무에 맞춘 AMI 이용 가능
- Spot Advisor: 대표 임무 수행 환경 설정 추천 제공

## 기타 비용 최적화 방법

### Auto Scaling

- 증가하는 수요에 맞춰 리소스 효율적 증가
- 감소하는 수요에 맞춰 리소스 제거로 낭비 방지

### EBS Lifecycle Manager

- EC2 인스턴스에 부착된 EBS 볼륨 데이터 보호
- 스냅샷 자동 생성 및 관리로 저장 비용 최적화
- 구 버전 스냅샷 자동 삭제, 최신 스냅샷만 유지
- EC2 대시보드에서 순회 정책 생성 가능
    - 새 스냅샷 생성 빈도 설정
    - 보유할 최대 스냅샷 수 설정

