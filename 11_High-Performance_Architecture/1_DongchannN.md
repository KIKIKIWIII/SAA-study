
## 컴퓨트 서비스

**목적과 한계**

- 컴퓨트 서비스는 **워크로드 수요에 맞춰 신속하고 효율적으로 컴퓨트 리소스를 제공**하는 것을 목표로 함. 
- 단순히 컴퓨트 리소스만으로는 해결할 수 없는 복잡한 워크로드가 존재하기 때문에, 컴퓨트 리소스의 **기능성과 연산력을 적절히 조합**하여 워크로드에 가장 적합한 인스턴스 타입을 선택하는 것이 중요.

**인스턴스 타입 선택 전략**

- 인스턴스 타입을 결정할 때는 다양한 환경 변수를 고려해야 함.
- 이러한 변수들은 인스턴스 성능의 기반이 되는 하드웨어의 각종 성능 요소를 추상화한 것임.

**주요 고려 요소**
- ECUs, vCPUs, Physical Processor
- Clock Speed, Memory, Instance Storage
- EBS-Optimized Available, Network Performance
- IPv6 Support, Processor Architecture
- Intel AES-NI, Standard-New Instructions, Intel AVS, Intel Turbo
    

**워크로드별 권장 인스턴스**
- **CPU 집약적 작업**: C 시리즈 (C6g, C7i)
- **메모리 집약적 작업**: R 시리즈 (R6g, R7i) - 대형 데이터베이스, 인메모리 캐시
- **범용 워크로드**: M 시리즈 (M6g, M7i) - 웹사이트, 애플리케이션 서버
- **가벼운 워크로드**: T 시리즈 (T4g, T3a) - 테스트 환경, 소규모 서비스
- **AI/ML 워크로드**
    - 딥러닝 훈련: P4/P5 GPU, Trainium (Trn1)
    - AI 추론: Inferentia (Inf1/Inf2)

**오토 스케일링**

단일 인스턴스로 워크로드를 처리할 수 없을 때는 **스케일 아웃을 통해 병렬적으로 워크로드를 처리**할 수 있음.

**전형적인 스케일 아웃 시나리오**  
온라인 쇼핑몰에서 블랙프라이데이나 특가 이벤트로 인해 트래픽이 급증할 때:
1. 기존 단일 웹서버로는 모든 요청 처리가 어려움
2. 동일한 웹서버 인스턴스를 여러 개 생성하여 트래픽 분산 처리
3. 로드밸런서를 통해 들어오는 요청을 여러 인스턴스에 균등 분배
    

**Auto Scaling의 이점**

- **수요 증가 시**: 성능 지표 확인 후 인스턴스 복제본 추가
- **수요 감소 시**: 미사용 리소스 자동 삭제
- **비용 효율성**: Auto Scaling 그룹을 통한 자동화로 극대화

**서버리스 워크로드**

EC2 인스턴스를 사용하지 않고도 컴퓨트 인프라를 배포할 수 있는 방법들이 존재함.

**주요 서버리스 옵션**
- **Docker 컨테이너**: 초경량 리소스로 거의 즉각적인 인프라 활용
- **Lambda**: 프로비저닝 불필요, 네트워크 이벤트 대응으로 매우 짧은 시간 실행
	- 다른 AWS와 쉽게 통합할 수 있으며, API Gateway를 이용해 API 요청 방식으로 워크로드 처리 가능
- **ECS + Fargate**: 리소스 활용률 극대화, 단일 인스턴스 환경에서도 신속한 워크로드 처리
	- Fargate는 사용자가 EC2 인스턴스(서버)를 직접 프로비저닝, 관리, 패치, 확장할 필요 없이, 컨테이너 이미지를 등록하면 AWS가 알아서 실행해주는 서비스

여기서 Docker 컨테이너 자체는 서버리스가 아니지만, Fargate 같은 서버리스 컨테이너 실행 서비스 덕분에 서버리스 워크로드의 한 종류로 분류됨.


## 스토리지 서비스

### RAID 최적화 EBS 볼륨

- RAID(Redundant Array of Independent Disks) 는 여러개의 드라이브를 단일 저장소 공간에 관리하는 데이터 저장소 기능

[RAID관련 자세한 설명](https://devocean.sk.com/blog/techBoardDetail.do?ID=163608)

**RAID 구성의 종류**
- **RAID 0**: 데이터 스트라이핑을 통해 데이터를 세분화하고 하나 이상의 디바이스에 저장
	- 대규모의 트랜잭션 데이터를 처리하는 DB I/O를 크게 높여줌
	- 성능과 용량을 향상시키지만 장애 허용 기능을 제공하지 않음
	- 고비용/성능 간 균형이 크게 중요하지 않은 시스템에 유용
- **RAID 1**: 다수의 볼륨에 데이터 복제본 생성
	- 전통적인 RAID1은 스트라이핑 또는 페리티 등의 기법을 사용하지 않아 성능을 높여주지 않음
	- 안정성과 관련있음
- **RAID 5, RAID 6**: 성능과 안정성 모두를 높이기 위한 옵션
	- IOPS 소모 문제 등의 이유로 사용을 권장하지 않음

**주의**
- RAID 기반 볼륨을 부트 드라이브로 사용하는 것 권장하지 않음
	- 드라이브 실패 시 부팅이 불가능해질 수 있음

### S3 크로스 리전 복제

**복제가 필요한 이유**
- 법적 규제
- 성능 개선
- 안정성 및 내구성

**S3 Cross-Region Replication(CRR)**
- 하나의 리전에 있는 버킷 데이터를 자동으로 그리고 비동기적으로 다른 리전의 버킷에 복제함
- source bucket에서 복제 규칙을 설정하고, destination bucket을 지정 및 필터링 할 수 있음
- 원본 버킷에서 객체가 삭제되면 대상 버킷에서도 삭제됨. 
	- 대상 버킷의 버저닝 기능이 활성화되어 있으면 객체가 유지됨.

### Amazon S3 Transfer Acceleration
- 로컬 PC에서 S3 버킷으로 대용량 파일을 자주 전송하는 경우 사용
- 엣지 로케이션을 이용해 데이터를 전송해 속도가 빠름
- 기가 바이트당 전송 비용은 $0.04 수준

### CloudFront와 S3 Origins

- 객체에 대한 접속을 CloudFront를 이용하여 최적화 할 수 있음
	- S3 버킷을 Origin으로 지정하면 S3에 직접 접근하지 않고 CloudFront를 통해 빠르고 안정하게 제공 가능
- 고객이 요청한 미디어 파일을 제공할 때 CloudFront 배포를 가리키도록 해 병목현상을 줄이고 별도의 로컬 호스팅 비용 또한 절감 가능
- S3에 저장된 이미지, 동영상, 파일 등을 CloudFront가 대신 캐싱·전송


---
## 데이터베이스

클라우드 기반의 데이터베이스 관리 시스템을 설계할 때 몇가지 중요한 결정이 필요

1. EC2 인스턴스에 직접 원하는 데이터베이스를 설치하기 VS AWS RDS 사용하기

	- 직접 DB를 설치하고 운영한다면 좀 더 저렴한 비용으로 더 많은 제어권한 가질 수 있음, 커스터마이징 자유로움
	- RDS를 사용하는 경우 소프트웨어 업데이트, 패치, 데이터 복제, 네트워크 관리 등에 자유로움

2. 분산 시스템에서 고려해야하는 CAP 이론

	분산 데이터베이스 시스템을 설계할 때는 CAP 이론(Consistency, Availability, Partition tolerance)을 반드시 고려해야 함
	- 일관성
		- 모든 노드가 동일한 시점에 동일한 데이터를 보여주는 특성
	- 가용성
		- 모든 요청에 대해서 정상적인 응답을 제공하는 특성
	- 파티션 내구성
		- 네트워크 분할이 발생해도 시스템이 계속 동작할 수 있는 특성. 노드간의 통신 장애가 발생하더라도 시스템이 동작해야함.

	 한꺼번에 충족할 수 있는 데이터 관리방법은 존재하지 않아, 3가지 요소 가운데 우선순위를 정해야함.
	 
3. 지연성, 내구성, 확장성
	- 지연성: IOPS 성능과 SSD/HDD 등 아키텍처에 따라 다양한 옵션이 존재. DB I/O 성능에 상당한 영향을 미침
	- 내구성 : 데이터베이스 인스턴스 복제본을 생성해 다수의 AZ 또는 리전에 배포할 수 있음
	- 확장성 : 자동 확장을 지원하게 할 수 있음

4. 비-데이터베이스 호스팅
	- 데이터는 때로 AWS S3와 같이 비-데이터베이스 환경에서 효과적으로 호스팅 할 수 있음

5. 서드파티 데이터 웨어하우스 및 관리도구

| 기술                             | 역할                                           | 플랫폼                                |
| ------------------------------ | -------------------------------------------- | ---------------------------------- |
| **Pivotal Greenplum Database** | 빅데이터 분석 및 데이터 과학 업무를 위한 대규모 병렬 데이터 웨어하우스     | EC2 마켓플레이스 AMI로 사용 가능              |
| **Snowflake**                  | 클라우드 환경에 최적화된 SaaS 기반 빅데이터 데이터 웨어하우스         | AWS 마켓플레이스에서 사용 가능                 |
| **Presto**                     | 빅데이터, 빈도수와 데이터 분석을 위한 분산 Hadoop 기반 SQL 쿼리 엔진 | Amazon Athena 또는 Amazon EMR을 통한 배포 |

---

## 네트워크 최적화 및 로드 밸런싱

1. 네트워크 최적화 기법

- **클라우드 컴퓨팅 워크로드**: 네트워크 연결이 되는 안 되는 여부에 따라 사용 가능 또는 불가능 여부가 결정되므로 신속하며 안정적으로 여러분의 클라우드 리소스에 접근할 수 있는지 확인해야 함
    
- **위치 기반 저지연성 라우팅**: Route 53과 CloudFront는 강력한 네트워크 정책에 있어 중요한 요소이며, VPC 엔드포인트와 AWS Direct Connect 또한 중요한 요소
    

2. Enhanced Networking 기능

- **광대역 EC2 인스턴스**: 타입 또한 네트워크 성능에 큰 차이를 가져올 수 있으며, 강화 네트워킹(Enhanced networking) 기능과 호환되는 인스턴스를 사용하면 데이터 전송 속도를 최대 100 Gbps까지 높일 수 있음
    
- **지원 가상 네트워크 인터페이스**: Intel 82599 Virtual Function(VF) 인터페이스, Elastic Network Adapter(ENA), Elastic Fabric Adapter(EFA) 등 세 가지 타입이 있음
    
- **특정 인스턴스 타입만 지원**: 각 특정 인스턴스 타입만 지원하며, 아래 링크에서 다양한 Linux 서버 OS 등 강화 네트워킹 기능 사용과 관련된 상세한 내용을 확인할 수 있음
    

3. 로드 밸런서 종류 및 특징

현재 클라우드에서 가장 중요한 네트워킹 성능 강화 기능은 로드 밸런싱이 아닐까 생각한다는 저자의 말이 있음.

**로드 밸런서의 기본 역할**

- **트래픽 분산** : 인프라 앞에 위치해 고객의 콘텐츠에 대한 모든 요구를 분산, 처리하는 네트워크 서비스
- **DNS 연동** : Route 53와 같은 DNS 서버 또는 CloudFront를 사용한다면 이들 서비스는 특정 주소에 대한 요청을 개별 서버가 아닌 로드 밸런서에 전달하는 역할을 한다
- **고가용성 보장**

**세부 특징**

- **Classic 로드 밸런서**: 초기에 만들어진 EC2 로드 밸런서 타입으로 HTTP, HTTPS, TCP 위크로트를 처리할 수 있으며, 이는 여전히 사용 가능하지만 지원이 중단된 상태(deprecated)
    
- **Elastic Load Balancer(ELB)**: 두 가지 로드 밸런서 타입을 제공하며, 기존 Classic 버전이 제공하지 않던 기능을 제공하며, VPC 외부 요소를 타겟으로 지정할 수 있고, 컨테이너화 애플리케이션을 지원
    

4. ALB vs NLB 비교

**Application Load Balancer(ALB) 특징**

- **OSI 레이어 7에서 작동**: 애플리케이션 레이어 또는 OSI 모델 기준, 레이어 7에서 작동
    
- **고급 라우팅**: 레이어 7 프로토콜은 호스트 기반 라우팅 및 패스 기반 라우팅을 허용하므로 사용자는 ALB를 이용해 마이크로서비스 또는 다른 티어 아키텍처의 서비스에 트래픽을 전송할 수 있음
    

**Network Load Balancer(NLB) 특징**

- **OSI 레이어 4에서 작동**: 트랜스포트 레이어(transport layer)에 해당하며, TCP 포트 번호를 기준으로 트래픽을 관리
    
- **고성능**: 고용량 데이터 전송 또는 급증하는 트래픽에 대응하기에 적합하며, Auto Scaling, Elastic Container Service, CloudFormation 등 서비스와 통합하여 사용할 수 있음
    
- **프로토콜 지원**: HTTP 또는 HTTPS 프로토콜을 사용하지 않음

