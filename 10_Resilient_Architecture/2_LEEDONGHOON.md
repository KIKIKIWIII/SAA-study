# 데이터 백업과 복원

### S3

저번에도 언급했지만, S3의 모든 스토리지 클래스(One Zone IA 제외)는 여러 AZ에 객체를 분산 저장해야 한다. 단일 AZ에만 객체를 넣으면 안되겠죠? 무슨 일이 일어날 수 있는 지는 다 알거라 믿어요

1. S3 버저닝 활성화
    
    : 저장 객체는 임의의 덮어쓰기나 실수에 의한 삭제로부터 안전해지고, 원본 객체 수정 시 새 버전이 만들어지며, 사용자는 언제든 수정 이전의 버전으로 복원할 수 있다
    
    - 원본 객체 삭제 시 S3 버킷에서 삭제되진 않고, 삭제 마크만 부여 (논리 삭제같은 느낌..?)
2. Cross Region 복제 기능 활성화 (CRR)
    
    : 모든 저장 객체를 동기적으로 소스 버킷에서 데스티네이션 버킷으로 복제
    
    - 소스 버킷 : 복제를 시작하는 원본 버킷 (객체가 업로드되는 버킷)
    - 데스티네이션 버킷 : 복제된 객체가 저장될 대상 버킷 (다른 리전 가능)
        - 소스 버킷에서 삭제된 내용은 데스티네이션 버킷에 반영되지 않는
    
    > 📌 이 기능 활성화하려면 두 버킷의 버저닝 기능을 모두 활성화해야 함
    

### Elastic File System

: EC2 인스턴스와 온프레미스 서버 간의 파일 공유를 가능케하는 관리형 네트워크 파일 시스템

- EFS는 리전 내 멀티 AZ 환경에 데이터를 저장해 개별 AZ 실패 상황에 대비

### Elastic Block Storage

리전 내 멀티 AZ 환경에 볼륨을 자동으로 복제해 개별 AZ 실패 상황에 대비하지만 데이터 변조 위험은 여전히 존재

- 스냅샷 생성(가장 간단한 방법) → S3에 저장
    - 직접 생성 or 일정 주기마다 자동으로 스냅샷 생성(Amazon Data Lifecycle Manager)
- 로그의 중요성
    - 애플리케이션 서버에 로그 파일이 있겠지만, 인스턴스 오류 시 혹은 Auto Scaling으로 종료되면 EBS와 함께 로그도 사라짐
    
    ⇒ **CloudWatch Logs**
    
    - EC2 인스턴스에서 발생하는 로그를 실시간으로 수집하여 AWS CloudWatch로 전송
    - 로그는 EC2 인스턴스가 삭제되어도 영구 보존 가능

### 데이터베이스의 복원성

관계형 DB? 비관계형 DB?

- 자체 관계형 데이터베이스
    
    → 해당 데이터베이스 엔진의 백업 기능 사용해 파일로 저장
    
    → 그 파일을 S3 또는 Glacier에 저장
    
- RDS
    
    → 데이터베이스 스냅샷 생성
    
    → 복원성을 높이기 위해
    
    - 한 AZ에는 primary instance
    - 다른 AZ에는 standby instance
    - 기본 인스턴스의 데이터를 대기 인스턴스에 동기적으로 복제
    - primary instance 실패 시 standby instance를 가동
    
    → 복원성을 극대화하기 위해
    
    - Amazon Aurora의 멀티 Aurora 복제본 활용
    - 3개의 AZ에 데이터베이스 저장
    - 기본 인스턴스 실패 시 다른 AZ의 Aurora 복제본이 기능을 대체
- DynamoDB
    
    → 멀티 AZ 환경에 테이블을 저장
    
    → 복원성 높이기 위해
    
    - 글로벌 테이블을 사용해 멀티 리전에 테이블을 복제
    - DynamoDB 테이블의 기준시점 복구를 설정해 자동 백업

# 복원성 네트워크 생성하기

모든 AWS 리소스는 네트워크에 의존한다. 그 중 VPC 설계는 중요한 고려사항으로, 또 다른 중요사항은 사용자가 VPC에 접속해 리소스를 활용하는 것이다.

### VPC 설계 시 고려사항

1. VPC 생성 시 충분한 크기의 CIDR 블록 생성
    - AWS 배포에 있어 더 많은 중복구현 요소를 추가할수록 더 많은 IP 주소가 필요
    - 더 많은 리소스를 추가해 성능을 높일수록 해당 리소스를 위한 IP주소가 많이 필요
2. 서브넷 생성 시 CIDR 블록에 충분한 미사용 주소 공간을 둬 미래의 서브넷 추가에 대비
    - AWS가 리전에 AZ를 추가하는 상황에 대비하기 위함
    - 다수의 서브넷을 이용해 리소스의 보안 수준을 높이고 관리 용이성도 높일 수 있음

### 복원성을 지닌 외부 연결

- **가용성**이란 사용자가 기대하는 수준으로 애플리케이션이 **항상 접속 가능**해야 함.
- 따라서 **애플리케이션 가용성은 네트워크 가용성에 의존**함.
- 일반적 연결은 **인터넷**이지만, 지연·속도 등 **불안정**할 수 있음.
- 중요한 애플리케이션이나 안정적 연결이 필요할 경우:

**⇒ AWS Direct Connect** 사용

- 전용 회선으로 AWS와 기업 데이터센터 연결
- **1~10 Gbps 전송 속도**, **일관된 저지연성**
- 백업 전송, 인터넷 우회 접속 등에 유용
- Direct Connect 외에도 VPC 피어링, VPN 등 **외부 네트워크** 연결 방식 존재
- **IP 주소 중복 방지** 및 **충분한 사설 IP 확보** 필요
